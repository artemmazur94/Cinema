use [CinemaDatabase];

create table [dbo].[Accounts] (
	[Id] int not null primary key,
	[Login] nvarchar(128) not null,
	[Password] nvarchar(128) not null,
	[Email] nvarchar(128) not null,
	[IsAdmin] bit not null,
	[IsBlocked] bit not null,
	[DiscountPoints] int not null
);

create table [dbo].[Profiles] (
	[Id] int not null primary key,
	[Name] nvarchar(128),
	[Surname] nvarchar(128),
	[Phone] nvarchar(32),
	[Birthday] datetime
);

alter table [dbo].[Profiles]
	add foreign key ([Id]) references [dbo].[Accounts]([Id])
	on delete cascade
	on update cascade;


create table [dbo].[Halls] (
	[Id] int not null primary key,
	[Name] nvarchar(128) not null,
	[Rows] int not null,
	[Places] int not null
);

create table [dbo].[Genres] (
	[Id] int not null primary key,
	[Name] nvarchar(64) not null,
	[Description] nvarchar(max) not null
);

create table [dbo].[Movies] (
	[Id] int not null primary key,
	[Name] nvarchar(64) not null,
	[Length] int not null,
	[Description] nvarchar(max) not null,
	[GenreId] int not null,
	[Director] nvarchar(64) null,
	[ActorsList] nvarchar(max),
	[ReleaseDate] datetime not null,
	foreign key ([GenreId]) references [dbo].[Genres]([Id])
);

create table [dbo].[Ratings] (
	[Rate] int not null,
	[AccountId] int not null,
	[MovieId] int not null,
	foreign key ([AccountId]) references [dbo].[Accounts]([Id]),
	foreign key ([MovieId]) references [dbo].[Movies]([Id])
);

create table [dbo].[Seances] (
	[Id] int not null primary key,
	[Price] decimal not null,
	[DateTime] datetime not null,
	[HallId] int not null,
	[MovieId] int not null,
	foreign key ([HallId]) references [dbo].[Halls]([Id]),
	foreign key ([MovieId]) references [dbo].[Movies]([Id])
);

create table [dbo].[Tickets] (
	[Id] int not null primary key,
	[Price] decimal not null,
	[Row] int not null,
	[Place] int not null,
	[SeanceId] int not null,
	[SaleDate] datetime not null,
	foreign key ([SeanceId]) references [dbo].[Seances]([Id])
);

create table [dbo].[Comments] (
	[Id] int not null primary key,
	[MovieId] int not null,
	[AccountId] int not null,
	[CommentText] nvarchar(max) not null,
	[DateTime] datetime not null,
	foreign key ([AccountId]) references [dbo].[Accounts]([Id]),
	foreign key ([MovieId]) references [dbo].[Movies]([Id])
);

create table [dbo].[Messages] (
	[Id] int not null primary key,
	[SenderId] int not null,
	[ReceiverId] int not null,
	[MessageTitle] nvarchar(64),
	[MessageText] nvarchar(max) not null,
	[DateTime] datetime not null,
	foreign key ([SenderId]) references [dbo].[Accounts]([Id]),
	foreign key ([ReceiverId]) references [dbo].[Accounts]([Id])
);

